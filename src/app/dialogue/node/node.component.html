<div *ngIf="dialogueNode"
     class="node bg-dark"
     cdkDrag>


    <div class="character-indicator w-100 d-flex justify-content-end align-items-center"
         [style.height]="'25px'"
         [style.background-color]="dialogueNode.character.color">

        <!-- 
            
        <div class="drag-handle"
             cdkDragHandle>
            <svg-icon name="icon_drag_move"></svg-icon>
        </div>
         -->
    </div>

    <div class="d-flex justify-content-between p-1">
        <app-port *ngIf="!dialogueNode.isRoot"
                  [port]="dialogueNode.inPort"></app-port>

        <button *ngIf="!dialogueNode.isRoot"
                (click)="onDelete.emit(dialogueNode)"
                class="btn btn-danger p-0 me-1">
            <svg-icon name="icon_delete"></svg-icon>
        </button>
    </div>

    <div class="node-header bg-gray d-flex justify-content-between align-items-center p-1">
        <div>
            <h4 class="text-white">Label</h4>
            <input type="text"
                   class="bg-dark text-white p-0"
                   value="{{dialogueNode.label}}"
                   (input)="onLabelInput($event)" />
        </div>

        <div>
            <h4 class="text-white">Character</h4>

            <select class="bg-dark text-white p-0"
                    (input)="onCharacterChange($event)">

                <option *ngFor="let char of characterOptions$ | async; let i = index"
                        value="{{char.guid}}"
                        [selected]="i === selectedCharacterIndex">
                    {{char.name}}
                </option>
            </select>

        </div>
        <button class="btn btn-success"
                (click)="addChoice()">
            <svg-icon name="icon_add"></svg-icon>Choice
        </button>
    </div>
    <div class="node-body bg-gray text-white p-1 d-flex">
        <div class="col-8">
            <h4>Content</h4>
            <textarea class="w-100 bg-dark text-white"
                      cols="15"
                      rows="3"
                      (input)="onContentInput($event)">{{dialogueNode.content}}</textarea>
        </div>
        <div cdkDropList
             (cdkDropListDropped)="cdkChoiceDropped($event)"
             class="col-4 ms-1 d-flex flex-column">
            <h4>Choices</h4>
            <app-choice *ngFor="let choice of dialogueNode.choices"
                        cdkDrag
                        cdkDragData="{{choice.outPort.guid}}"
                        (cdkDragStarted)="cdkChoiceDragStarted($event, choice)"
                        (cdkDragEnded)="cdkChoiceDragEnded($event, choice)"
                        (onDeleteClicked)="deleteChoice(choice)"
                        (onUpdate)="updateChoice($event)"
                        [choice]="choice"></app-choice>
        </div>

    </div>
</div>